%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% This file is an extension library of PGF/Tikz.
%%%
%%% This library can be used to typeset pcb layouts.
%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% Copyright 2014 by Willem Van Onsem
%
% This file may be distributed and/or modified under the GNU General Public License.

\pgfkeys{/pgf/.cd,
	pcbdippins/.initial=14,
	pcbdipdx/.initial=3 cm,
	pcbdipwidth/.initial=4 cm,
	pcbdipheight/.initial=1 cm,
	pcbdipnudge/.initial=0.5 cm,
	pcbcircleout/.initial=0.3 cm,
	pcbcirclein/.initial=0.15 cm,
	pcbcirclediff/.initial=1 cm,
	pcblabel/.initial=
}
\newdimen\pgfutil@tempdimc
\newdimen\pgfutil@tempdimd
\newdimen\pgfutil@tempdime
\newdimen\pgfutil@tempdimf
\newdimen\pgfutil@tempdimg
\newdimen\pgfutil@tempdimh
\newcount\pgfutil@tempcnta
\newcount\pgfutil@tempcntb
\newcount\pgfutil@tempcntc
\newcount\pgfutil@tempcntd
\newcount\pgfutil@tempcnte
\newcount\pgfutil@tempcntf
\newcount\pgfutil@tempcntg
\newcount\pgfutil@tempcnth

\pgfdeclareshape{pcbbase} {
  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  }
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{midwest}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.85\pgfutil@tempdima}
}

\pgfdeclareshape{pcbvia} {
  \inheritsavedanchors[from=pcbbase]
  \anchor{pin0}{\centerpoint}
  \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
  \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
  \backgroundpath{
    \pgfseteorule
    \pgfutil@tempdima=\circlein
    \pgfutil@tempdimb=\circleout
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
    \color{gray}
    \pgfusepath{fill}
  }
}

\pgfdeclareshape{pcbto92} {
  \inheritsavedanchors[from=pcbbase]
  \anchor{pin0}{\pgfutil@tempdimc=\circlediff\centerpoint\advance\pgf@x by-\pgfutil@tempdimc}
  \anchor{pin1}{\centerpoint}
  \anchor{pin2}{\pgfutil@tempdimc=\circlediff\centerpoint\advance\pgf@x by\pgfutil@tempdimc}
  \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
  \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
  \saveddimen\circlediff{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclediff}}}
  \backgroundpath{
    \pgfseteorule
    \pgfutil@tempdima=\circlein
    \pgfutil@tempdimb=\circleout
    \pgfutil@tempdimc=\circlediff
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@x by\pgfutil@tempdimc\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@x by\pgfutil@tempdimc\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimc\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimc\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \color{gray}
    \pgfusepath{fill}
    \pgfsetlinewidth{2\pgflinewidth}
    \centerpoint\pgf@xa=\pgf@x\pgf@ya=\pgf@y\advance\pgf@xa by0.707\pgfutil@tempdimc\advance\pgf@ya by0.707\pgfutil@tempdimc
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}\pgfpatharc{45}{-225}{\pgfutil@tempdimc and \pgfutil@tempdimc}\pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@ya}}\pgfpathclose
    \color{black}
    \pgfusepath{stroke}
  }
}

\pgfdeclareshape{pcbdip} {
  \inheritsavedanchors[from=pcbbase]
  \savedmacro\diphalfpins{%
    \pgfmathdivide{\pgfkeysvalueof{/pgf/pcbdippins}}{2}
    \let\diphalfpins\pgfmathresult
  }
  \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
  \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
  \saveddimen\circlediff{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclediff}}}
  \saveddimen\dipdx{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipdx}}}
  \saveddimen\dipwidth{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipwidth}}}
  \saveddimen\dipheight{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipheight}}}
  \saveddimen\dipnudge{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipnudge}}}
  \backgroundpath{
    \pgfseteorule
    \pgfutil@tempdima=\circlein
    \pgfutil@tempdimb=\circleout
    \pgfutil@tempdimc=\circlediff
    \pgfutil@tempdimd=\dipdx
    \pgfutil@tempdime=0.5\pgfutil@tempdimc
    \pgfmathloop
    \ifnum\pgfmathcounter>\diphalfpins
    \else
      \advance\pgfutil@tempdime by -0.5\pgfutil@tempdimc
      \repeatpgfmathloop
    \fi
    \pgfutil@tempdimf=\dipheight
    \pgfutil@tempdimg=\dipwidth
    \pgfutil@tempdimh=\dipnudge
    \pgfmathloop
    \ifnum\pgfmathcounter>\diphalfpins %pins
    \else
      \centerpoint\advance\pgf@x by-0.5\pgfutil@tempdimd\advance\pgf@y by\pgfutil@tempdime\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
      \centerpoint\advance\pgf@x by-0.5\pgfutil@tempdimd\advance\pgf@y by\pgfutil@tempdime\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
      \centerpoint\advance\pgf@x by0.5\pgfutil@tempdimd\advance\pgf@y by\pgfutil@tempdime\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
      \centerpoint\advance\pgf@x by0.5\pgfutil@tempdimd\advance\pgf@y by\pgfutil@tempdime\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
      \advance\pgfutil@tempdime by\pgfutil@tempdimc
      \repeatpgfmathloop
    \fi
    \color{gray}
    \pgfusepath{fill}
    \pgfsetlinewidth{2\pgflinewidth}
    \advance\pgfutil@tempdime by-\pgfutil@tempdimc
    \advance\pgfutil@tempdime by0.5\pgfutil@tempdimf
    \centerpoint\advance\pgf@x by-0.5\pgfutil@tempdimg\advance\pgf@y by\pgfutil@tempdime\pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimh\advance\pgf@y by\pgfutil@tempdime\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}\pgfpatharc{-180}{0}{\pgfutil@tempdimh and \pgfutil@tempdimh}
    \centerpoint\advance\pgf@x by0.5\pgfutil@tempdimg\advance\pgf@y by\pgfutil@tempdime\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint\advance\pgf@x by0.5\pgfutil@tempdimg\advance\pgf@y by-\pgfutil@tempdime\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint\advance\pgf@x by-0.5\pgfutil@tempdimg\advance\pgf@y by-\pgfutil@tempdime\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}\pgfpathclose
    \color{black}
    \pgfusepath{stroke}
    
    \begingroup
    \tikzset{pcb/part labels}
    \tikz@textfont
    
    \centerpoint
    \pgftext[base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{4017}}
    
    \endgroup
  }
}

\pgfdeclareshape{pcbtact} {
  \inheritsavedanchors[from=pcbbase]
  \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
  \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
  \saveddimen\circlediff{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclediff}}}
  \saveddimen\dipwidth{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipwidth}}}
  \saveddimen\dipheight{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipheight}}}
  \saveddimen\dipnudge{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbdipnudge}}}
  \backgroundpath{
    \pgfseteorule
    \pgfutil@tempdima=\circlein
    \pgfutil@tempdimb=\circleout
    \pgfutil@tempdimc=\circlediff
    \pgfutil@tempdimd=\dipdx
    \pgfutil@tempdime=0.5\pgfutil@tempdimc
    \pgfutil@tempdimf=\dipheight
    \pgfutil@tempdimg=\dipwidth
    \pgfutil@tempdimh=\dipnudge
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimc\advance\pgf@y by0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimc\advance\pgf@y by0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@y by0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@y by0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@x by\pgfutil@tempdimc\advance\pgf@y by0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@x by\pgfutil@tempdimc\advance\pgf@y by0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimc\advance\pgf@y by-0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@x by-\pgfutil@tempdimc\advance\pgf@y by-0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@y by-0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@y by-0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \centerpoint\advance\pgf@x by\pgfutil@tempdimc\advance\pgf@y by-0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \centerpoint\advance\pgf@x by\pgfutil@tempdimc\advance\pgf@y by-0.5\pgfutil@tempdimd\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
    \color{gray}
    \pgfusepath{fill}
    \pgfsetlinewidth{2\pgflinewidth}
    \color{black}
    \pgfusepath{stroke}
  }
}

\pgfdeclareshape{pcbr} {
  \inheritsavedanchors[from=pcbbase]
  \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pcbcirclein}}}
  \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pcbcircleout}}}
  \saveddimen\dpin{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pcbdpin}}}
  \backgroundpath{
    \pgfseteorule
    \pgfutil@tempdima=\circlein
    \pgfutil@tempdimb=\circleout
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
%     \centerpoint\advance\pgf@x by-\halfwidth\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
%     \centerpoint\advance\pgf@x by-\halfwidth\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdimb}
%     \centerpoint\advance\pgf@x by\halfwidth\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
%     \centerpoint\advance\pgf@x by\halfwidth\pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{\pgfutil@tempdima}
    \color{gray}
    \pgfusepath{fill}
%     \centerpoint\advance\pgf@x by-\halfwidth\advance\pgf@x by-0.1\pgfutil@tempdimc\advance\pgf@y by0.1\pgfutil@tempdimc\pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@y by0.5\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by2.2\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@y by-0.5\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@y by-0.2\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by-\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@y by-0.5\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by-2.2\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@y by0.5\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by-\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \pgfpathclose
%     \centerpoint\advance\pgf@x by-0.1\halfwidth\advance\pgf@x by1.1\pgfutil@tempdimc\advance\pgf@y by0.4\pgfutil@tempdimc\pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by1.8\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@y by-0.8\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \advance\pgf@x by-1.8\pgfutil@tempdimc\pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
%     \pgfpathclose
%     \color{black}
%     \pgfusepath{fill}
  }
}
% 
% \pgfdeclareshape{pcbtact} {
%   \inheritsavedanchors[from=pcbbase]
%   \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pcbcirclein}}}
%   \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pcbcircleout}}}
%   \saveddimen\dpin{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pcbdpin}}}
%   \backgroundpath{
%   }
% }
% 
% \pgfdeclareshape{pcbcrystal} {
%   \inheritsavedanchors[from=pcbbase]
%   \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
%   \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
%   \backgroundpath{
%     \pgfseteorule
%     \pgfutil@tempdima=\circlein
%     \pgfutil@tempdimb=\circleout
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
%     \color{gray}
%     \pgfusepath{fill}
%   }
% }
% 
% \pgfdeclareshape{pcbelco} {
%   \inheritsavedanchors[from=pcbbase]
%   \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
%   \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
%   \backgroundpath{
%     \pgfseteorule
%     \pgfutil@tempdima=\circlein
%     \pgfutil@tempdimb=\circleout
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
%     \color{gray}
%     \pgfusepath{fill}
%   }
% }
% 
% \pgfdeclareshape{pcbsip} {
%   \inheritsavedanchors[from=pcbbase]
%   \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
%   \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
%   \backgroundpath{
%     \pgfseteorule
%     \pgfutil@tempdima=\circlein
%     \pgfutil@tempdimb=\circleout
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
%     \color{gray}
%     \pgfusepath{fill}
%   }
% }
% 
% \pgfdeclareshape{pcbzip} {
%   \inheritsavedanchors[from=pcbbase]
%   \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
%   \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
%   \backgroundpath{
%     \pgfseteorule
%     \pgfutil@tempdima=\circlein
%     \pgfutil@tempdimb=\circleout
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
%     \color{gray}
%     \pgfusepath{fill}
%   }
% }
% 
% \pgfdeclareshape{pcbjumber} {
%   \inheritsavedanchors[from=pcbbase]
%   \saveddimen\circlein{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcirclein}}}
%   \saveddimen\circleout{\pgfmathsetlength{\pgf@x}{\pgfkeysvalueof{/pgf/pcbcircleout}}}
%   \backgroundpath{
%     \pgfseteorule
%     \pgfutil@tempdima=\circlein
%     \pgfutil@tempdimb=\circleout
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}
%     \pgfpathcircle{\centerpoint}{\pgfutil@tempdimb}
%     \color{gray}
%     \pgfusepath{fill}
%   }
% }